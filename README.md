# H∆Ø·ªöNG D·∫™N C√ÄI ƒê·∫∂T V√Ä CH·∫†Y D·ª∞ √ÅN LAMDONGAPP

**D·ª± √°n:** Website Th∆∞∆°ng m·∫°i ƒêi·ªán t·ª≠ ƒê·∫∑c S·∫£n L√¢m ƒê·ªìng  
**Tech Stack:** Next.js 14 + TypeScript + PostgreSQL + Express.js  
**Version:** 1.0.0

---

## M·ª§C L·ª§C

1. [Y√™u C·∫ßu H·ªá Th·ªëng](#1-y√™u-c·∫ßu-h·ªá-th·ªëng)
2. [C√†i ƒê·∫∑t Dependencies](#2-c√†i-ƒë·∫∑t-dependencies)
3. [Setup Database PostgreSQL](#3-setup-database-postgresql)
4. [Setup Cloudinary](#4-setup-cloudinary)
5. [C·∫•u H√¨nh Environment Variables](#5-c·∫•u-h√¨nh-environment-variables)
6. [Ch·∫°y D·ª± √Ån](#6-ch·∫°y-d·ª±-√°n)
7. [Truy C·∫≠p Swagger API Documentation](#7-truy-c·∫≠p-swagger-api-documentation)
8. [T√†i Kho·∫£n M·∫∑c ƒê·ªãnh](#8-t√†i-kho·∫£n-m·∫∑c-ƒë·ªãnh)
9. [C·∫•u Tr√∫c D·ª± √Ån](#9-c·∫•u-tr√∫c-d·ª±-√°n)
10. [Troubleshooting](#10-troubleshooting)

---

## 1. Y√äU C·∫¶U H·ªÜ TH·ªêNG

### Ph·∫ßn m·ªÅm c·∫ßn c√†i ƒë·∫∑t:

| Ph·∫ßn m·ªÅm | Version | Link Download |
|----------|---------|---------------|
| **Node.js** | >= 18.x | https://nodejs.org |
| **pnpm** | Latest | `npm install -g pnpm` |
| **PostgreSQL** | >= 17.x | https://www.postgresql.org/download/ |
| **pgAdmin 4** | Latest | ƒêi k√®m v·ªõi PostgreSQL |
| **Git** | Latest | https://git-scm.com |
| **VS Code** | Latest (khuy·∫øn ngh·ªã) | https://code.visualstudio.com |

### Ki·ªÉm tra version ƒë√£ c√†i:

```bash
node --version    # v18.x ho·∫∑c cao h∆°n
npm --version     # v9.x ho·∫∑c cao h∆°n
pnpm --version    # Latest
git --version     # Latest
```

---

## 2. C√ÄI ƒê·∫∂T DEPENDENCIES

### B∆∞·ªõc 1: Clone Repository

```bash
git clone https://github.com/giabao-lab/lamdongapp_new.git
cd lamdongapp_new
```

### B∆∞·ªõc 2: C√†i ƒë·∫∑t Frontend Dependencies

```bash
# ·ªû th∆∞ m·ª•c root
pnpm install
```

### B∆∞·ªõc 3: C√†i ƒë·∫∑t Backend Dependencies

```bash
cd backend
npm install
cd ..
```

**L∆∞u √Ω:** N·∫øu g·∫∑p l·ªói khi c√†i ƒë·∫∑t, th·ª≠:
```bash
# X√≥a node_modules v√† package-lock.json
rm -rf node_modules package-lock.json
npm cache clean --force
npm install
```

---

## 3. SETUP DATABASE POSTGRESQL

### B∆∞·ªõc 1: C√†i ƒë·∫∑t PostgreSQL 17

1. Download PostgreSQL 17 t·∫°i: https://www.postgresql.org/download/
2. Ch·∫°y installer v√† l√†m theo h∆∞·ªõng d·∫´n
3. **Quan tr·ªçng:** Nh·ªõ m·∫≠t kh·∫©u cho user `postgres`
4. Port m·∫∑c ƒë·ªãnh: `5432`

### B∆∞·ªõc 2: Kh·ªüi ƒë·ªông PostgreSQL Service

**Tr√™n Windows:**
```cmd
# M·ªü Services (Windows + R, g√µ services.msc)
# T√¨m "postgresql-x64-17" v√† Start

# Ho·∫∑c d√πng Command Prompt (Run as Administrator)
net start postgresql-x64-17
```

**Tr√™n MacOS:**
```bash
brew services start postgresql@17
```

**Tr√™n Linux:**
```bash
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

### B∆∞·ªõc 3: T·∫°o Database

**C√°ch 1: S·ª≠ d·ª•ng pgAdmin 4 (Khuy·∫øn ngh·ªã)**

1. M·ªü **pgAdmin 4**
2. Connect t·ªõi PostgreSQL 17 (nh·∫≠p password ƒë√£ t·∫°o)
3. Click ph·∫£i **Databases** ‚Üí **Create** ‚Üí **Database**
4. Nh·∫≠p th√¥ng tin:
   - **Database name:** `lamdongapp_db`
   - **Owner:** `postgres`
   - **Comment:** `Database for Lam Dong Specialties App`
5. Click **Save**

**C√°ch 2: S·ª≠ d·ª•ng Command Line**

```bash
# M·ªü psql
psql -U postgres

# T·∫°o database
CREATE DATABASE lamdongapp_db;

# Ki·ªÉm tra
\l

# Tho√°t
\q
```

### B∆∞·ªõc 4: Import Database Schema

1. Trong pgAdmin 4, click v√†o database `lamdongapp_db`
2. Click **Tools** ‚Üí **Query Tool**
3. M·ªü file `backend/database_schema.sql`
4. Copy to√†n b·ªô n·ªôi dung
5. Paste v√†o Query Tool
6. Click **Execute** (‚ö°) ho·∫∑c nh·∫•n **F5**

**Ho·∫∑c d√πng Command Line:**

```bash
cd backend
psql -U postgres -d lamdongapp_db -f database_schema.sql
```

### B∆∞·ªõc 5: Verify Database

Trong pgAdmin ho·∫∑c psql, ch·∫°y query:

```sql
-- Ki·ªÉm tra tables
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public';

-- Ki·ªÉm tra sample products
SELECT id, name, price, category FROM products;

-- Ki·ªÉm tra admin user
SELECT email, name, role FROM users WHERE role = 'admin';
```

**K·∫øt qu·∫£ mong ƒë·ª£i:**
- 7 tables: users, products, categories, cart_items, orders, order_items, reviews
- 5 sample products
- 1 admin user
- 5 categories

---

## 4. SETUP CLOUDINARY

### B∆∞·ªõc 1: ƒêƒÉng k√Ω t√†i kho·∫£n Cloudinary (FREE)

1. Truy c·∫≠p: https://cloudinary.com/users/register/free
2. ƒêƒÉng k√Ω t√†i kho·∫£n (email ho·∫∑c Google)
3. X√°c nh·∫≠n email
4. **Free plan:** 25GB storage, 25GB bandwidth/th√°ng

### B∆∞·ªõc 2: L·∫•y API Credentials

1. ƒêƒÉng nh·∫≠p v√†o Cloudinary
2. V√†o **Dashboard**: https://console.cloudinary.com/console
3. Ghi l·∫°i th√¥ng tin:
   ```
   Cloud Name: [V√≠ d·ª•: dxxxxxxxx]
   API Key: [V√≠ d·ª•: 123456789012345]
   API Secret: [V√≠ d·ª•: abcdefghijklmnopqrstuvwxyz]
   ```

### B∆∞·ªõc 3: T·∫°o Upload Preset

1. V√†o **Settings** ‚Üí **Upload** tab
2. Scroll xu·ªëng **Upload presets**
3. Click **Add upload preset**
4. C·∫•u h√¨nh:
   - **Preset name:** `lamdong_products`
   - **Signing Mode:** **Unsigned** (quan tr·ªçng!)
   - **Folder:** `lamdong-app/products`
   - **Use filename:** ‚úì Checked
   - **Unique filename:** ‚úì Checked
   - **Allowed formats:** jpg, png, gif, webp
   - **Max file size:** 10 MB
5. Click **Save**

### B∆∞·ªõc 4: C·∫≠p nh·∫≠t Frontend Code

M·ªü file `components/ui/image-upload.tsx` v√† s·ª≠a d√≤ng 18-19:

```typescript
// Thay ƒë·ªïi c√°c gi√° tr·ªã n√†y
const CLOUDINARY_CLOUD_NAME = "your_cloud_name"      // Thay b·∫±ng Cloud Name
const CLOUDINARY_UPLOAD_PRESET = "lamdong_products"  // Thay b·∫±ng Upload Preset
```

### B∆∞·ªõc 5: Test Upload

1. Ch·∫°y frontend: `npm run dev`
2. Truy c·∫≠p: http://localhost:3000/admin/products
3. Click "Th√™m s·∫£n ph·∫©m"
4. K√©o th·∫£ h√¨nh ·∫£nh v√†o upload zone
5. Ki·ªÉm tra h√¨nh ƒë√£ upload t·∫°i: https://console.cloudinary.com/console/media_library

**Chi ti·∫øt th√™m:** Xem file `CLOUDINARY_SETUP.md`

---

## 5. C·∫§U H√åNH ENVIRONMENT VARIABLES

### Backend Environment (.env)

T·∫°o file `backend/.env`:

```env
# Server Configuration
PORT=5000
NODE_ENV=development

# Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_NAME=lamdongapp_db
DB_USER=postgres
DB_PASSWORD=your_postgres_password_here

# JWT Configuration
JWT_SECRET=your_super_secret_jwt_key_here_change_in_production
JWT_EXPIRE=7d

# Cloudinary Configuration (Optional - n·∫øu upload t·ª´ backend)
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret

# CORS Configuration
CORS_ORIGIN=http://localhost:3000

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
```

**Quan tr·ªçng:**
- Thay `your_postgres_password_here` b·∫±ng m·∫≠t kh·∫©u PostgreSQL c·ªßa b·∫°n
- Thay `your_super_secret_jwt_key_here` b·∫±ng m·ªôt chu·ªói b√≠ m·∫≠t m·∫°nh
- Thay c√°c gi√° tr·ªã Cloudinary n·∫øu s·ª≠ d·ª•ng backend upload

### Frontend Environment (.env.local)

T·∫°o file `.env.local` ·ªü th∆∞ m·ª•c root:

```env
# API URL
NEXT_PUBLIC_API_URL=http://localhost:5000/api/v1

# Cloudinary (n·∫øu c·∫ßn)
NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=your_cloud_name
NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET=lamdong_products
```

---

## 6. CH·∫†Y D·ª∞ √ÅN

### Ph∆∞∆°ng √°n 1: Ch·∫°y Frontend v√† Backend ri√™ng bi·ªát

**Terminal 1 - Backend:**
```bash
cd backend
npm run dev
```

Output mong ƒë·ª£i:
```
‚úÖ Database connected successfully
üöÄ Server running on port 5000
üìö Swagger docs available at http://localhost:5000/api-docs
```

**Terminal 2 - Frontend:**
```bash
# ·ªû th∆∞ m·ª•c root
npm run dev
```

Output mong ƒë·ª£i:
```
‚ñ≤ Next.js 14.2.16
- Local:        http://localhost:3000
- Ready in 2.5s
```

### Ph∆∞∆°ng √°n 2: S·ª≠ d·ª•ng PowerShell Script (Windows)

```powershell
# ·ªû th∆∞ m·ª•c root
.\start-dev.ps1
```

Script n√†y s·∫Ω t·ª± ƒë·ªông:
1. Kh·ªüi ƒë·ªông backend ·ªü port 5000
2. Kh·ªüi ƒë·ªông frontend ·ªü port 3000
3. M·ªü 2 terminal ri√™ng bi·ªát

### Ph∆∞∆°ng √°n 3: Build Production

```bash
# Build frontend
npm run build
npm start

# Build backend
cd backend
npm run build
npm start
```

---

## 7. TRUY C·∫¨P SWAGGER API DOCUMENTATION

### Sau khi backend ƒë√£ ch·∫°y:

```
http://localhost:5000/api-docs
```

### T√≠nh nƒÉng Swagger UI:

‚úÖ Xem t·∫•t c·∫£ API endpoints  
‚úÖ Xem chi ti·∫øt request/response schemas  
‚úÖ Test API tr·ª±c ti·∫øp t·ª´ browser  
‚úÖ Authentication v·ªõi JWT token  
‚úÖ Xem v√≠ d·ª• request/response  

### C√°ch s·ª≠ d·ª•ng Swagger:

1. **Test endpoint c√¥ng khai:**
   - Click v√†o endpoint (VD: `GET /products`)
   - Click "Try it out"
   - Click "Execute"
   - Xem response

2. **Test endpoint c·∫ßn authentication:**
   - Login qua `POST /auth/login`
   - Copy token t·ª´ response
   - Click n√∫t **"Authorize"** ·ªü g√≥c ph·∫£i
   - Nh·∫≠p: `Bearer YOUR_TOKEN_HERE`
   - Click "Authorize" ‚Üí "Close"
   - Test c√°c protected endpoints

**Chi ti·∫øt th√™m:** Xem file `backend/SWAGGER_GUIDE.md`

---

## 8. T√ÄI KHO·∫¢N M·∫∂C ƒê·ªäNH

### Admin Account:
```
Email: admin@dacsanlamdong.vn
Password: admin123
Role: admin
```

### Customer Account:
```
Email: user@example.com
Password: user123
Role: customer
```

### Test v·ªõi Swagger:

1. V√†o http://localhost:5000/api-docs
2. T√¨m endpoint `POST /api/v1/auth/login`
3. Click "Try it out"
4. Nh·∫≠p credentials admin
5. Execute v√† l·∫•y token
6. Authorize v·ªõi token ƒë·ªÉ test admin APIs

---

## 9. C·∫§U TR√öC D·ª∞ √ÅN

```
lamdongapp/
‚îú‚îÄ‚îÄ app/                          # Next.js App Router (Frontend)
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx                 # Trang ch·ªß
‚îÇ   ‚îú‚îÄ‚îÄ about/                   # Trang gi·ªõi thi·ªáu
‚îÇ   ‚îú‚îÄ‚îÄ products/                # Trang s·∫£n ph·∫©m
‚îÇ   ‚îú‚îÄ‚îÄ cart/                    # Gi·ªè h√†ng
‚îÇ   ‚îú‚îÄ‚îÄ checkout/                # Thanh to√°n
‚îÇ   ‚îú‚îÄ‚îÄ orders/                  # ƒê∆°n h√†ng
‚îÇ   ‚îú‚îÄ‚îÄ profile/                 # Th√¥ng tin c√° nh√¢n
‚îÇ   ‚îú‚îÄ‚îÄ auth/                    # ƒêƒÉng nh·∫≠p/ƒêƒÉng k√Ω
‚îÇ   ‚îî‚îÄ‚îÄ admin/                   # Admin dashboard
‚îÇ       ‚îú‚îÄ‚îÄ products/            # Qu·∫£n l√Ω s·∫£n ph·∫©m
‚îÇ       ‚îú‚îÄ‚îÄ orders/              # Qu·∫£n l√Ω ƒë∆°n h√†ng
‚îÇ       ‚îú‚îÄ‚îÄ users/               # Qu·∫£n l√Ω users
‚îÇ       ‚îî‚îÄ‚îÄ system-status/       # Tr·∫°ng th√°i h·ªá th·ªëng
‚îÇ
‚îú‚îÄ‚îÄ backend/                      # Backend API (Express.js)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server.ts            # Main server
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/              # Configuration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/         # Request handlers
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/          # Middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/              # Database models
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/              # API routes
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/               # Utilities
‚îÇ   ‚îú‚îÄ‚îÄ database_schema.sql      # Database schema
‚îÇ   ‚îú‚îÄ‚îÄ .env                     # Backend environment
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îÇ
‚îú‚îÄ‚îÄ components/                   # React Components
‚îÇ   ‚îú‚îÄ‚îÄ ui/                      # shadcn/ui components
‚îÇ   ‚îú‚îÄ‚îÄ layout/                  # Layout components
‚îÇ   ‚îú‚îÄ‚îÄ products/                # Product components
‚îÇ   ‚îî‚îÄ‚îÄ auth/                    # Auth components
‚îÇ
‚îú‚îÄ‚îÄ lib/                         # Services & Utilities
‚îÇ   ‚îú‚îÄ‚îÄ api-client.ts           # API HTTP client
‚îÇ   ‚îú‚îÄ‚îÄ auth-service.ts         # Authentication service
‚îÇ   ‚îú‚îÄ‚îÄ products-service.ts     # Product service
‚îÇ   ‚îú‚îÄ‚îÄ orders-service.ts       # Order service
‚îÇ   ‚îú‚îÄ‚îÄ admin-service.ts        # Admin service
‚îÇ   ‚îú‚îÄ‚îÄ auth-context.tsx        # Auth context
‚îÇ   ‚îú‚îÄ‚îÄ cart-context.tsx        # Cart context
‚îÇ   ‚îî‚îÄ‚îÄ types.ts                # TypeScript types
‚îÇ
‚îú‚îÄ‚îÄ public/                      # Static assets
‚îú‚îÄ‚îÄ .env.local                   # Frontend environment
‚îú‚îÄ‚îÄ package.json                 # Frontend dependencies
‚îî‚îÄ‚îÄ tsconfig.json               # TypeScript config
```

---

## 10. TROUBLESHOOTING

### L·ªói: "Cannot connect to database"

**Nguy√™n nh√¢n:** PostgreSQL service ch∆∞a ch·∫°y ho·∫∑c sai credentials

**Gi·∫£i ph√°p:**
```bash
# Windows
net start postgresql-x64-17

# Ki·ªÉm tra .env
# ƒê·∫£m b·∫£o DB_PASSWORD ƒë√∫ng v·ªõi password PostgreSQL
```

### L·ªói: "Port 5000 already in use"

**Nguy√™n nh√¢n:** Port ƒë√£ b·ªã chi·∫øm b·ªüi process kh√°c

**Gi·∫£i ph√°p:**
```bash
# Windows - T√¨m v√† kill process
netstat -ano | findstr :5000
taskkill /PID <PID> /F

# Ho·∫∑c ƒë·ªïi port trong backend/.env
PORT=5001
```

### L·ªói: "Port 3000 already in use"

**Gi·∫£i ph√°p:**
```bash
# Kill process
# Windows
netstat -ano | findstr :3000
taskkill /PID <PID> /F

# Ho·∫∑c ch·∫°y v·ªõi port kh√°c
npm run dev -- -p 3001
```

### L·ªói: "Module not found"

**Gi·∫£i ph√°p:**
```bash
# X√≥a node_modules v√† reinstall
rm -rf node_modules package-lock.json
npm install

# Backend
cd backend
rm -rf node_modules package-lock.json
npm install
```

### L·ªói: "JWT token invalid"

**Nguy√™n nh√¢n:** Token h·∫øt h·∫°n ho·∫∑c JWT_SECRET kh√¥ng kh·ªõp

**Gi·∫£i ph√°p:**
- Login l·∫°i ƒë·ªÉ l·∫•y token m·ªõi
- Ki·ªÉm tra JWT_SECRET trong backend/.env

### L·ªói: "Cloudinary upload failed"

**Nguy√™n nh√¢n:** Sai Cloud Name ho·∫∑c Upload Preset

**Gi·∫£i ph√°p:**
1. Ki·ªÉm tra `components/ui/image-upload.tsx`
2. ƒê·∫£m b·∫£o Upload Preset l√† **Unsigned**
3. Ki·ªÉm tra network trong Chrome DevTools

### Database schema l·ªói

**Gi·∫£i ph√°p:**
```sql
-- Reset database
DROP SCHEMA public CASCADE;
CREATE SCHEMA public;

-- Import l·∫°i schema
-- D√πng pgAdmin ho·∫∑c psql
\i backend/database_schema.sql
```

### CORS Error

**Nguy√™n nh√¢n:** Backend kh√¥ng cho ph√©p frontend origin

**Gi·∫£i ph√°p:**
```env
# backend/.env
CORS_ORIGIN=http://localhost:3000

# Ho·∫∑c cho ph√©p t·∫•t c·∫£ (ch·ªâ development)
CORS_ORIGIN=*
```

### Build error "Type error"

**Gi·∫£i ph√°p:**
```bash
# X√≥a .next v√† rebuild
rm -rf .next
npm run build

# Check TypeScript errors
npx tsc --noEmit
```

---

## üéØ CHECKLIST SAU KHI C√ÄI ƒê·∫∂T

- [ ] PostgreSQL service ƒëang ch·∫°y
- [ ] Database `lamdongapp_db` ƒë√£ ƒë∆∞·ª£c t·∫°o
- [ ] Database schema ƒë√£ import th√†nh c√¥ng (7 tables)
- [ ] Backend `.env` ƒë√£ c·∫•u h√¨nh ƒë√∫ng
- [ ] Frontend `.env.local` ƒë√£ c·∫•u h√¨nh (n·∫øu c·∫ßn)
- [ ] Dependencies ƒë√£ c√†i ƒë·∫∑t (frontend & backend)
- [ ] Backend ch·∫°y th√†nh c√¥ng ·ªü port 5000
- [ ] Frontend ch·∫°y th√†nh c√¥ng ·ªü port 3000
- [ ] Swagger UI truy c·∫≠p ƒë∆∞·ª£c t·∫°i http://localhost:5000/api-docs
- [ ] Login th√†nh c√¥ng v·ªõi admin account
- [ ] Cloudinary upload ho·∫°t ƒë·ªông (optional)

---

## üìö T√ÄI LI·ªÜU THAM KH·∫¢O

- **Database Setup:** `backend/DATABASE_SETUP.md`
- **Cloudinary Setup:** `CLOUDINARY_SETUP.md`
- **Swagger Guide:** `backend/SWAGGER_GUIDE.md`
- **Project Report:** `BAO_CAO_DU_AN.md`
- **API Documentation:** http://localhost:5000/api-docs

---

## üÜò H·ªñ TR·ª¢

### GitHub Issues
https://github.com/giabao-lab/lamdongapp_new/issues

### Email
admin@dacsanlamdong.vn

### Documentation
- Next.js: https://nextjs.org/docs
- PostgreSQL: https://www.postgresql.org/docs/
- Express.js: https://expressjs.com/
- Swagger: https://swagger.io/docs/

---

## üìù GHI CH√ö

### Development URLs:
- **Frontend:** http://localhost:3000
- **Backend API:** http://localhost:5000/api/v1
- **Swagger UI:** http://localhost:5000/api-docs
- **pgAdmin:** http://localhost:5050 (n·∫øu c√†i standalone)

### C√°c l·ªánh h·ªØu √≠ch:

```bash
# Frontend
npm run dev          # Development
npm run build        # Production build
npm run start        # Start production
npm run lint         # Lint code

# Backend
cd backend
npm run dev          # Development v·ªõi nodemon
npm run build        # Build TypeScript
npm start            # Production

# Database
psql -U postgres                    # M·ªü psql
psql -U postgres -d lamdongapp_db   # Connect to DB
pg_dump lamdongapp_db > backup.sql  # Backup
psql -U postgres -d lamdongapp_db < backup.sql  # Restore
```

---

**üéâ Ch√∫c b·∫°n code vui v·∫ª!**

**Version:** 1.0.0  
**Last Updated:** 29/10/2025  
**Author:** LamdongApp Team
